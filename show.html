<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Siteosphia</title>

    <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/Inksphere/Swahwa/main/10149443.png">
    <style>
        /* ----------  NEW STYLES  ---------- */
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background:#fff;min-height:100vh;padding:20px;color:#333}
        .dashboard-container{max-width:1200px;margin:0 auto}
        .main-title{color:#333;text-align:center;margin-bottom:30px;font-size:2.5rem}
        .card{background:#fff;backdrop-filter:blur(10px);border-radius:15px;padding:25px;box-shadow:0 8px 32px rgba(0,0,0,.1);transition:transform .3s ease;border:1px solid #e1e5e9;margin-bottom:25px}
        .card:hover{transform:translateY(-5px);box-shadow:0 12px 40px rgba(0,0,0,.15)}
        .card-header{display:flex;align-items:center;gap:15px;margin-bottom:20px}
        .card-icon{width:40px;height:40px;border-radius:10px;background:linear-gradient(45deg,#667eea 0%,#764ba2 100%);display:flex;align-items:center;justify-content:center;color:#fff;font-size:18px}
        .card h3{color:#2c3e50;font-size:18px;margin:0}
        .card p{color:#7f8c8d;line-height:1.6;margin-bottom:15px}

        /* Login Card */
        .login-card{max-width:500px;margin:50px auto;text-align:center}
        .login-form{display:flex;flex-direction:column;gap:20px;margin-top:20px}
        .login-form input{padding:15px 20px;border:2px solid #e1e5e9;border-radius:10px;font-size:1.1rem;text-align:center;transition:all .3s ease}
        .login-form input:focus{outline:none;border-color:#667eea;box-shadow:0 0 0 3px rgba(102,126,234,.1)}

        /* Profile Header */
        .profile-header{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);border-radius:15px;padding:30px;margin-bottom:30px;color:#fff;text-align:center}
        .profile-photo{width:120px;height:120px;border-radius:50%;border:4px solid #ff8a00;overflow:hidden;display:flex;align-items:center;justify-content:center;background:#f8f9fa;font-size:3rem;color:#667eea;margin:0 auto 20px}
        .student-name{font-size:2rem;font-weight:bold;margin-bottom:10px;text-shadow:1px 1px 2px rgba(0,0,0,.3)}
        .student-role{font-size:1.2rem;opacity:.9;font-weight:500;margin-bottom:20px}
        .profile-actions{display:flex;gap:15px;justify-content:center;flex-wrap:wrap}
        .profile-btn{padding:12px 24px;background:rgba(255,255,255,.2);color:#fff;border:2px solid rgba(255,255,255,.3);border-radius:8px;cursor:pointer;font-weight:600;transition:all .3s ease;text-decoration:none;display:inline-flex;align-items:center;gap:8px;backdrop-filter:blur(10px)}
        .profile-btn:hover{background:rgba(255,255,255,.3);border-color:rgba(255,255,255,.5);transform:translateY(-2px)}
        .profile-btn.danger{background:rgba(220,53,69,.8);border-color:#dc3545}
        .profile-btn.danger:hover{background:#dc3545}

        /* Stats Grid */
        .stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px;margin-top:20px}
        .stat-item{text-align:center;padding:20px;background:#f8f9fa;border-radius:10px;border:2px solid #e1e5e9;transition:all .3s ease}
        .stat-item:hover{transform:translateY(-2px);box-shadow:0 4px 15px rgba(0,0,0,.1)}
        .stat-item.credit{border-color:#28a745}
        .stat-item.debit{border-color:#dc3545}
        .stat-item.balance.positive{border-color:#28a745}
        .stat-item.balance.negative{border-color:#dc3545}
        .stat-number{font-size:24px;font-weight:bold;color:#667eea;display:block;margin-bottom:5px}
        .stat-number.credit{color:#28a745}
        .stat-number.debit{color:#dc3545}
        .stat-number.balance.positive{color:#28a745}
        .stat-number.balance.negative{color:#dc3545}
        .stat-label{font-size:12px;color:#7f8c8d;text-transform:uppercase;letter-spacing:.5px}

        /* Form & Filter Grid */
        .form-grid,.filter-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:15px;align-items:end;margin-bottom:15px}
        input,select{padding:12px 15px;border:2px solid #e1e5e9;border-radius:8px;font-size:1rem;transition:all .3s ease}
        input:focus,select:focus{outline:none;border-color:#667eea;box-shadow:0 0 0 3px rgba(102,126,234,.1)}
        .btn{padding:12px 24px;border:none;border-radius:8px;cursor:pointer;font-weight:500;transition:all .3s ease;text-decoration:none;display:inline-flex;align-items:center;gap:8px;font-size:14px;text-transform:uppercase;letter-spacing:.5px}
        .btn-primary{background:linear-gradient(45deg,#667eea 0%,#764ba2 100%);color:#fff}
        .btn-success{background:linear-gradient(45deg,#28a745 0%,#20c997 100%);color:#fff}
        .btn-warning{background:linear-gradient(45deg,#ff7043 0%,#ff5722 100%);color:#fff}
        .btn-info{background:linear-gradient(45deg,#17a2b8 0%,#138496 100%);color:#fff}
        .btn:hover{transform:translateY(-2px);box-shadow:0 4px 15px rgba(0,0,0,.2)}
        .btn:disabled{opacity:.6;cursor:not-allowed;transform:none}

        /* Table */
        table{width:100%;border-collapse:collapse;margin-top:20px;background:#fff;border-radius:8px;overflow:hidden}
        th,td{border:1px solid #e1e5e9;padding:12px;text-align:left}
        th{background:linear-gradient(45deg,#667eea 0%,#764ba2 100%);color:#fff;font-weight:600;text-transform:uppercase;font-size:.9rem;letter-spacing:.5px}
        tr:nth-child(even){background:#f8f9fa}
        tr:hover{background:#e3f2fd;transition:background-color .3s ease}
        .credit-row{border-left:4px solid #28a745}
        .debit-row{border-left:4px solid #dc3545}
        .text-success{color:#28a745!important;font-weight:bold}
        .text-danger{color:#dc3545!important;font-weight:bold}
        .amount-display{font-weight:bold;font-family:'Courier New',monospace}

        /* Pagination */
        .pagination-controls{display:flex;justify-content:center;align-items:center;gap:10px;margin-top:20px;flex-wrap:wrap}
        .pagination-btn{padding:8px 12px;background:linear-gradient(45deg,#667eea 0%,#764ba2 100%);color:#fff;border:none;border-radius:5px;cursor:pointer;font-size:.9rem;transition:all .3s ease}
        .pagination-btn:hover{transform:translateY(-1px);box-shadow:0 3px 10px rgba(102,126,234,.4)}
        .pagination-btn:disabled{opacity:.5;cursor:not-allowed;transform:none}
        .pagination-btn.active{background:linear-gradient(45deg,#4caf50 0%,#66bb6a 100%)}

        /* Utility */
        .hidden{display:none}
        .error{color:#dc3545;background:#f8d7da;padding:15px;border-radius:8px;margin:15px 0;text-align:center;font-weight:500;border:1px solid #f5c6cb}
        .loading{color:#6c757d;font-style:italic;text-align:center;padding:20px}
        .status-message{text-align:center;padding:20px;color:#6c757d;font-size:1.1rem}

        /* Responsive */
        @media(max-width:768px){
            .main-title{font-size:2rem}
            .form-grid,.filter-grid{grid-template-columns:1fr}
            .profile-actions{flex-direction:column;width:100%}
            .profile-btn{width:100%;justify-content:center}
            .student-name{font-size:1.5rem}
            .stats-grid{grid-template-columns:1fr}
            .pagination-controls{flex-direction:column}
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <h1 class="main-title">üìò Student Financial Dashboard</h1>

        <!-- Login Section -->
        <div id="loginSection" class="card login-card">
            <div class="card-header">
                <div class="card-icon">üëã</div>
                <h3>Welcome! Please Enter Your AD.NO</h3>
            </div>
            <div class="login-form">
                <input type="text" id="usernameInput" placeholder="Enter your name or AD.NO" maxlength="50">
                <button class="btn btn-primary" onclick="login()">üöÄ Login</button>
                <button class="btn btn-info" onclick="window.location.href='admin-dashboard.html'">üè† Home</button>
            </div>
        </div>

        <!-- Dashboard Section -->
        <div id="dashboardSection" class="hidden">
            <!-- Profile Header -->
            <div class="profile-header">
                <div class="profile-photo">
                    <span id="profileIcon">üë§</span>
                </div>
                <h2 class="student-name" id="studentName">STUDENT NAME</h2>
                <p class="student-role">Student Dashboard</p>
                <div class="profile-actions">
                    <button class="profile-btn danger" onclick="logout()">üö™ Check Another</button>
                    <button class="profile-btn" onclick="window.location.href='admin-dashboard.html'">üè† Home</button>
                </div>
            </div>

            <div class="dashboard-content">
                <!-- Financial Summary -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">üí∞</div>
                        <h3>Financial Summary</h3>
                    </div>
                    <p>Track your financial activities and current balance.</p>
                    <div class="stats-grid">
                        <div class="stat-item credit">
                            <span class="stat-number credit" id="totalCredit">‚Çπ0</span>
                            <span class="stat-label">Total Credit</span>
                        </div>
                        <div class="stat-item debit">
                            <span class="stat-number debit" id="totalDebit">‚Çπ0</span>
                            <span class="stat-label">Total Debit</span>
                        </div>
                        <div class="stat-item balance" id="balanceCard">
                            <span class="stat-number balance" id="balanceAmountElement">‚Çπ<span id="balanceAmount">0</span></span>
                            <span class="stat-label">Current Balance</span>
                        </div>
                    </div>
                    <div style="margin-top:20px">
                        <button class="btn btn-success" onclick="refreshData()">üîÑ Refresh Data</button>
                    </div>
                </div>

                <!-- Transaction Ledger -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">üìÑ</div>
                        <h3>Transaction Ledger</h3>
                    </div>
                    <p>View your complete transaction history.</p>
                    <div id="ledgerStatus" class="loading">Loading transactions...</div>
                    <table id="ledgerTable" style="display:none">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Type</th>
                                <th>Description</th>
                                <th>Amount</th>
                            </tr>
                        </thead>
                        <tbody id="ledgerBody"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        /* ----------  MINIMAL JS TO MATCH ORIGINAL  ---------- */
         let currentUsername = null;
        let debugMode = false;
        let allLedgerData = [];
        let filteredData = [];
        let currentPage = 1;
        let itemsPerPage = 10;
        let predefinedItems = [];
        let currentItemInputMode = 'predefined';
        let receivedTransactions = new Set();
        const api = "https://script.google.com/macros/s/AKfycbwl2547hMsMHLi0l1e9xcq6Ue_eV9wgL4gVWyCIASTZZrY2VY-brzxsqVRsKtYSbRk2/exec";

        // Student data mapping
        const studentData = {
            '1050': 'MUHAMMAD SINAN PC',
            '1070': 'MUHAMMED MUSAMMIL B K',
            '1074': 'MUAD .M',
            '1058': 'MUHAMMED JALAL AT',
            '1051': 'MUHAMMAD HISHAM T',
            '1056': 'MUHAMMED SHADIN N.M.',
            '1076': 'MUHAMMED MINHAJ KK',
            '1071': 'SAYYID MOHAMMAD ZUHAIR A K',
            '1075': 'MUHAMMED HASHIM P',
            '1061': 'ANSHID M P',
            '1072': 'SINAN TP',
            '1078': 'MUHAMMED RABIEUE MK',
            '1088': 'NAEEM K',
            '1082': 'MUHAMMED SANEEN',
            '1090': 'MUHAMMED BASSAM',
            '1066': 'HASHIM K P',
            '1063': 'RISHADH. T',
            '1073': 'MUHAMMAD MUSTHAFA KK',
            '1068': 'MUHAMMED UVAIS.EK',
            '1053': 'AMEEN T',
            '1040': 'MUHAMMAD RIFAD K',
            '1059': 'AFSAL',
            '1064': 'SHAMIL M',
            '1013': 'SAHAD.K',
            '1087': 'SHAMIL. A',
            '1089': 'ADIL SHAH M',
            '1084': 'ASIM M',
            '1024': 'FADHIL KATTIPARUTHI',
            '1008': 'MINHAJ',
            '1086': 'NIDAL',
            '1085': 'NAFIH',
            '1014': 'MURSHID MK'
        };

        /* Login / Logout */
        function login() {
            const username = document.getElementById("usernameInput").value.trim();
            if (!username) { alert("‚ö†Ô∏è Please enter your name."); return; }

            currentUsername = username;
            document.getElementById("studentName").innerText = username;

            document.getElementById("loginSection").classList.add("hidden");
            document.getElementById("dashboardSection").classList.remove("hidden");

            fetchSummary();
            fetchLedger();

            const newUrl = new URL(window.location);
            newUrl.searchParams.set('user', username);
            window.history.pushState({}, '', newUrl);
        }

        function logout() {
            currentUsername = null;
            document.getElementById("usernameInput").value = "";
            document.getElementById("totalCredit").innerText = "‚Çπ0";
            document.getElementById("totalDebit").innerText = "‚Çπ0";
            document.getElementById("balanceAmount").innerText = "0";
            document.getElementById("ledgerBody").innerHTML = "";
            document.getElementById("ledgerTable").style.display = "none";
            document.getElementById("ledgerStatus").innerHTML = '<div class="loading">Loading transactions...</div>';

            document.getElementById("loginSection").classList.remove("hidden");
            document.getElementById("dashboardSection").classList.add("hidden");

            const newUrl = new URL(window.location);
            newUrl.searchParams.delete('user');
            window.history.pushState({}, '', newUrl);
        }

        /* Data Fetchers */
        function fetchSummary() {
            if (!currentUsername) return;
            fetch(`${api}?action=get_summary&username=${encodeURIComponent(currentUsername)}`)
                .then(r => r.json())
                .then(d => {
                    document.getElementById("totalCredit").innerText = "‚Çπ" + (d.totalCredit || 0).toFixed(2);
                    document.getElementById("totalDebit").innerText = "‚Çπ" + (d.totalDebit || 0).toFixed(2);
                    const bal = d.balance || 0;
                    document.getElementById("balanceAmount").innerText = bal.toFixed(2);
                    const card = document.getElementById("balanceCard");
                    card.classList.remove("positive", "negative");
                    if (bal >= 0) card.classList.add("positive"); else card.classList.add("negative");
                })
                .catch(console.error);
        }

        function fetchLedger() {
            if (!currentUsername) return;
            fetch(`${api}?action=get_ledger&username=${encodeURIComponent(currentUsername)}`)
                .then(r => r.json())
                .then(d => {
                    const body = document.getElementById("ledgerBody");
                    body.innerHTML = "";
                    const data = d.ledger || [];
                    if (data.length === 0) {
                        document.getElementById("ledgerStatus").innerHTML = '<div class="status-message">üìù No transactions found.</div>';
                        return;
                    }
                    document.getElementById("ledgerStatus").style.display = "none";
                    document.getElementById("ledgerTable").style.display = "table";
                    data.forEach(e => {
                        const tr = document.createElement("tr");
                        tr.className = e.type === "credit" ? "credit-row" : "debit-row";
                        tr.innerHTML = `
                            <td>${new Date(e.date).toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric"})}</td>
                            <td>${e.type === "credit" ? "üí∞" : "üí∏"} ${e.type}</td>
                            <td>${e.item}</td>
                            <td class="amount-display ${e.type === "credit" ? "text-success" : "text-danger"}">‚Çπ${e.amount.toFixed(2)}</td>
                        `;
                        body.appendChild(tr);
                    });
                })
                .catch(console.error);
        }

        function refreshData() { fetchSummary(); fetchLedger(); }

        /* Auto-login from URL */
        const urlUsername = new URLSearchParams(window.location.search).get("user");
        if (urlUsername) { document.getElementById("usernameInput").value = urlUsername; login(); }

        document.getElementById("usernameInput").addEventListener("keypress", e => { if (e.key === "Enter") login(); });
    </script>
</body>
</html>

